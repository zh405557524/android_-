# 计算机网络原理

## 五、传输层

### 1、tcp和udp 的应用场景



* dod 模型 主要分 应用层、传输层、网络层、网络接口层
  * 应用层:Telnet、Ftp，SMTP，DNS，HTTP 以及其他应用协议
  * 传输层TCP，UDP
  * 网络层 IP、ARP、RARP、ICMP
  * 网络接口 各种通信网络接口(以太网等)(物理网络)
* 传输层的tpc 是基于网络层的pi协议，应用的http 是基于传输层的tcp协议 ，socket 是提供一个针对tcp或者udp的编程接口
* tpc 与udp的区别

  * tcp 需要将传输的文件分段 传输 简历会话 可靠传输 流量控制 比如 方问 网页，发送邮件，下载。都是用的tcp 协议
  * udp 一个数据就能完成数据通讯 不分段 不需要建立会话  不需要流量控制  不可靠输出  例如 请求dns ，qq聊天发送消息，还比如特殊的 直播推流。

### 2、传输层协议和应用层协议之间关系

* 应用协议 等于 传输层协议+端口
  * http 协议 等于 TCP+80端口
  * dns =TCP +53 /UDP+53
  * https = TCP+443
  * RDP = TCP+3389
  * ftp = TCP +21
  * 访问共享  = TCP +445 
  * SMTP （发邮件）  TCP + 25
  * POP3 = TCP +110
  * telnet = TCP + 23
  * SQL = TCP+1433
  * DNS = UDP +53



### 3、服务和应用层协议之间的关系

* 1、服务使用  TCP 或 UDP 的端口 侦听客户端的请求 2、客户端 使用ip地址定位服务器，使用目标端口定位服务  3、可以在服务器网卡上设置只开放必要的端口 实现服务器网络安全。



#### tcp 连接管理

* TCP连接
  * 传输连接有三个阶段,即：连接建立、数据传送和连接释放
  * TCP 连接的建立都是采用客户服务器方式 
  * 主动发起连接建立的应用进程叫做客户(client)
  * 被动等待连接建立的应用进程叫做服务器(server) 
* 三次握手建立TCP连接
  * 先手客户端发送一个 同步数据包 ，tcp 首部(同步标记)(SYN)是 1 ，确认标记(ACK)是0，序号是一个数值，服务端受到这个数据包 就知道是一个主动发起连接的数据包，服务器会发送一个数据包进行回应，首部是1，确认标记是 1 ，序号是 服务器指定的数值，确认号(ack) 是客户端的数值+1，接着客户端发送一个数据包给服务端，确认标记 是1，序号是 客户端指定的数值+1,确认号是服务端数值+1.这样就成功建立一个tpc连接，客户端与服务器开始进行数据传输。
  * 两次就可以确定通信为什么需要三次，因为，在网络不好的情况下，客户端会发多次建立连接的请求，服务端多次响应服务端的请求，但是，客户端收到过一次确认数据包后，会不认这个确认，但服务端会一直等待 客户端的数据传输，这样会造成资源浪费，所以需要第三个数据包的确认。
  * 通信结束后，需要释放连接，客户端发送一个数据包给服务器 FIN = 1,服务器收到这个数据包后，给客户端一个确认，客户端不在发送数据给服务端，但是服务端会发送数据给客户端，当服务端数据发送完了，会发送一个数据包，FIN = 1，客户端会给你服务器一个确认包，然后他们不会发送数据了，连接就释放了。服务器会关掉连接，客户端会等待 2个报文传输时间，也就是2分钟。因为客户端发送给服务端的确认包，会丢失，如果客户端关闭了，那么服务器发送给客户端的关闭包，客户端就不会做处理，服务器就不会关闭，造成资源的浪费。



















